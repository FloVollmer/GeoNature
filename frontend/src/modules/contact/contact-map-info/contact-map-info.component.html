<div class="row row-sm">
  <div class="col-sm-12 col-md-5 padding-sm map-container">
      <pnx-map class="map-card" height="95  vh"> </pnx-map>
  </div>
  <div class="col-sm-12 col-md-7 padding-sm form-container">
    <div class="card">
      <div class="card-header">
        <h4 > Relevé</h4>
        <button 
          matTooltip="Edit relevé {{id}}"
          type="button" id="edit"
          class="btn btn-success"
          [disabled]="userReleveCruved?.E == false">
            <i 
            class="fa fa-pencil-square-o fa-lg"
            aria-hidden="true" 
            (click)="fs.onEditReleve(id)">
            </i>
        </button>

      </div>


      <div class="card-block releve">
        <p><b> Relevé numéro </b>: {{releve?.id}} <b> Observateur(s) </b>: {{observers}} </p>
        <p> <b> Entre le  </b>: {{dateMin}}  <b> et le </b>: {{dateMax}}  </p> 
        <p> <b> Altitude min  </b>: {{releve?.properties.altitude_min }}<b> Altitude max  </b>: {{releve?.properties.altitude_max }} </p>

        <div class="row row-sm">
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 padding-0">
            <pnx-datasets
            placeholder="{{ 'Releve.Dataset' | translate }}"
            [parentFormControl]="releveForm.controls.properties.controls.id_dataset"
            appId="14"
            [disabled]=disabled>
          </pnx-datasets>
          </div>
          <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 padding-sm">
            <pnx-nomenclature
            placeholder= "{{ 'Releve.ObsTechnique' | translate }}"
            [parentFormControl]="releveForm.controls.properties.controls.id_nomenclature_obs_technique"
            [idTypeNomenclature]="100"
            [disabled]=disabled
          >
          </pnx-nomenclature>
          </div>
        </div>


        <p> <pnx-areas-intersected-modal [geojson]="releve"> </pnx-areas-intersected-modal> </p>

          <label> {{ 'Taxon.ObservedTaxon' | translate }} </label>
          <div class="row row-sm">
            <div class="col-xs-6 col-sm-6 col-md-6 col-lg-6 padding-sm">
              <img *ngIf="showSpinner" src="assets/images/Spinner.gif" 
              alt="Chargement..." 
              height="40" 
              width="40">
              <div *ngIf="!showSpinner">
                <table class="table table-hover ">
                  <tr [ngClass]="{'table-success': i == selectedIndex}" *ngFor="let occ of releve?.properties.t_occurrences_contact; let i = index" 
                  (click)="selectOccurrence(occ, i)">
                    <td class="selected-taxon">{{occ.taxon?.nom_complet}}</td>
                    <td><i class="fa fa-eye clickable" aria-hidden="true"></i></td>
                  </tr>
                </table>
              </div> 
            </div>
          </div>          
    </div>
    
    <div *ngIf="selectedOccurrence" class="card info-occurrence">
      <label class="card-header"> <b> Détails: </b>  {{selectedOccurrence?.taxon?.nom_valide}} </label>
      <div class="card-block">
        <ul class="nav nav-tabs" role="tablist">
          <li class="nav-item">
            <a class="nav-link active" data-toggle="tab" href="#occurrence" role="tab">Info observation</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#counting" role="tab">Dénombrement</a>
          </li>
        </ul>
        <!-- OCCURRENCE -->
        <!-- Tab panes -->
        <div class="tab-content">
          <div class="tab-pane active" id="occurrence" role="tabpanel">
            <div class="row row-sm">
              <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                  <pnx-nomenclature 
                    placeholder="{{ 'Taxon.ObsMethod' | translate }}"
                    [parentFormControl]="occurrenceForm.controls.id_nomenclature_obs_meth"
                    [idTypeNomenclature]="14" 
                    [disabled]="disabled">
                  </pnx-nomenclature>
              </div>
                <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                  <pnx-nomenclature 
                    placeholder="{{ 'Taxon.BiologicalCondition' | translate }}"
                    [parentFormControl]="occurrenceForm.controls.id_nomenclature_bio_condition"
                    [idTypeNomenclature]="7" 
                    [disabled]="disabled" > 
                  </pnx-nomenclature>
                </div>
              </div>
              <div class="row row-sm">
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                    <pnx-nomenclature 
                      placeholder="{{ 'Taxon.BiologicalStatus' | translate }}"
                      [parentFormControl]="occurrenceForm.controls.id_nomenclature_bio_status"
                      [idTypeNomenclature]="13" 
                      [disabled]="disabled"> 
                    </pnx-nomenclature> 
                  </div>          
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                    <pnx-nomenclature 
                      placeholder="{{ 'Taxon.Naturalness' | translate }}"
                      [parentFormControl]="occurrenceForm.controls.id_nomenclature_naturalness"
                      [idTypeNomenclature]="8" 
                      [disabled]="disabled">
                    </pnx-nomenclature>
                  </div>
                  <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 padding-sm">
                      <pnx-nomenclature 
                        placeholder="{{ 'Taxon.DeterminationMethod' | translate }}"
                        [parentFormControl]="occurrenceForm.controls.id_nomenclature_determination_method"
                        [idTypeNomenclature]="106" 
                        [regne]="fs.currentTaxon.regne" 
                        [group2Inpn]="fs.currentTaxon.group2_inpn"
                        [disabled]="disabled">
                    </pnx-nomenclature>
                  </div>
                </div>
          
                <div class="row row-sm">
                  <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 padding-sm">
                      <small> {{ 'Taxon.Determiner' | translate }} </small>
                      <input class="form-control form-control-sm"
                      [formControl]="occurrenceForm.controls.determiner"
                      [disableControl]="disabled"
                        type="text">
                  </div>
                  <div class="col-xs-4 col-sm-4 col-md-4 col-lg-4 padding-sm"> 
                    <pnx-nomenclature 
                      placeholder="{{ 'Taxon.ValidationStatus' | translate }}"
                      [parentFormControl]="occurrenceForm.controls.id_nomenclature_exist_proof"
                      [idTypeNomenclature]="101" 
                      [disabled]="disabled">
                    </pnx-nomenclature>
                  </div>
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                      <pnx-nomenclature 
                        placeholder="{{ 'Taxon.ExistProof' | translate }}"
                        [parentFormControl]="occurrenceForm.controls.id_nomenclature_exist_proof"
                        [idTypeNomenclature]="15" 
                        [disabled]="disabled">
                      </pnx-nomenclature>
                    </div>
                </div>
          
                <div class="row row-sm">
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm form-group">
                      <small> {{ 'Taxon.DigitalProof' | translate }} </small>
                      <input class="form-control form-control-sm"
                      [formControl]="occurrenceForm.controls.digital_proof"
                      [disableControl]="disabled"
                        type="text">
                  </div>
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm">
                    <small> {{ 'Taxon.NonDigitalProof' | translate }} </small>
                    <input class="form-control form-control-sm"
                    [formControl]="occurrenceForm.controls.non_digital_proof"
                    [disableControl]="disabled"
                      type="text"> 
                  </div>
                </div>

                <div class="row row-sm form-group" id="row-commentaire">
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-6 padding-sm">               
                      <textarea placeholder="{{ 'Releve.Comment' | translate }}"
                      class="form-control" [formControl]="occurrenceForm.controls.comment" 
                        rows="2"
                        id="commentaire"
                        [disableControl]="disabled">
                      </textarea>
                  </div>
                </div>

          </div>
          <!-- denombrement -->
          <div class="tab-pane" id="counting" role="tabpanel">
            <div *ngFor="let counting of selectedOccurrence?.cor_counting_contact; let index = index">
                <div class="row row-sm">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-4 padding-sm col-counting">
                        <pnx-nomenclature
                          placeholder="{{ 'Counting.LifeStage' | translate }}" 
                          [parentFormControl]="countingFormArray.controls[index].controls.id_nomenclature_life_stage"
                          [idTypeNomenclature]="10"
                          [disabled]="disabled"> 
                        </pnx-nomenclature>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 padding-sm col-counting">
                        <pnx-nomenclature
                          placeholder="{{ 'Counting.Sex' | translate }}"
                          [parentFormControl]="countingFormArray.controls[index].controls.id_nomenclature_sex"
                          [idTypeNomenclature]="9"
                          [disabled]="disabled">
                        </pnx-nomenclature>
                  </div>
                  <div class="col-xs-12 col-sm-12 col-md-12 col-lg-5 padding-sm col-counting">
                        <pnx-nomenclature 
                          placeholder="{{ 'Counting.CountingObject' | translate }}"
                          [parentFormControl]="countingFormArray.controls[index].controls.id_nomenclature_obj_count"
                          [idTypeNomenclature]="6"
                          [disabled]="disabled" >
                        </pnx-nomenclature>
                  </div>
            
                </div>
                <div class="form-group row row-sm">
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-5 padding-sm col-counting">
                        <pnx-nomenclature
                          #typeDenombrement
                          placeholder="{{ 'Counting.CountingType' | translate }}"
                          [parentFormControl]="countingFormArray.controls[index].controls.id_nomenclature_type_count"
                          [idTypeNomenclature]="21"
                          [disabled]="disabled">
                        </pnx-nomenclature> 
                  </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 padding-sm col-counting">
                      <div class="form-group" [ngClass]="{'has-danger' : countingFormArray.controls[index].controls.count_min.invalid}">
                        <small> {{ 'Counting.NumberMin' | translate }} </small>
                        <input class="form-control form-control-sm" type="number" 
                        [formControl]="countingFormArray.controls[index].controls.count_min"
                        [disableControl]="disabled">
                      </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-3 padding-sm col-counting">
                      <div class="form-group" [ngClass]="{'has-danger' : countingFormArray.controls[index].controls.count_max.invalid}">
                          <small> {{ 'Counting.NumberMax' | translate }} </small>
                        <input class="form-control form-control-sm" type="number" 
                        [formControl]="countingFormArray.controls[index].controls.count_max"
                        [disableControl]="disabled">
                      </div>
                    </div>
                    <div class="col-xs-12 col-sm-12 col-md-12 col-lg-1 padding-sm col-counting" *ngIf="index == length -1 && index != 0">
                      <button id="add-counting" type="button" class="btn btn-danger btn-sm" (click)="onRemoveCounting(index)">
                          <i class="fa fa-times" aria-hidden="true"></i>
                      </button>
                    </div>
                </div>
                <hr>
          
                </div>
            </div>
          </div>
      <!-- end tab -->
        </div>
      </div>  
      <!-- end card selected -->
  </div>
</div>
